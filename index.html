<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* Ganti font sesuai selera */
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 80%; /* Sesuaikan lebar */
            max-width: 600px; /* Lebar maksimum */
            text-align: center;
        }

        h1 {
            color: #4CAF50; /* Hijau */
            margin-bottom: 20px;
        }
        #setup, #gameArea{
             margin-bottom: 20px;
        }

        input[type="text"] {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: calc(100% - 22px); /* Lebar input */
        }

        button {
            background-color: #4CAF50; /* Hijau */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #367c39;
        }

        #question {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .answer {
            background-color: #eee;
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .answer:hover {
            background-color: #ddd;
        }

        #roomInfo {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 20px;
            text-align: left;
        }

        #userList {
            list-style: none;
            padding: 0;
        }

        #userList li {
            margin: 5px 0;
        }

        #message {
            margin-top: 10px;
            color: #888;
        }
        #restartBtn{
            margin-top: 2rem;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-question-circle"></i> Quiz Game</h1>

        <!-- Form untuk create/join room -->
        <div id="setup">
            <input type="text" id="username" placeholder="Enter your username">
             <input type="text" id="joinRoomId" class="hidden" placeholder="Enter room ID (if joining)">
            <div>
            <button id="createRoomBtn"><i class="fas fa-plus-square"></i> Create Room</button>
            <button id="joinRoomBtn"><i class="fas fa-sign-in-alt"></i> Join Room</button>
            </div>
        </div>

        <!-- Area permainan (awalnya disembunyikan) -->
        <div id="gameArea" class="hidden">
            <div id="roomInfo">
                Room ID: <span id="roomId"></span><br>
                Room Name: <span id="roomName"></span><br>
                <div>Users: <ul id="userList"></ul></div>
                <p>Time Left: <span id="timeLeft"></span></p>
                <p>Question <span id="currentQuestionNum"></span> of <span id="totalQuestion"></span></p>

            </div>

            <div id="quizContainer">
                <div id="question"></div>
                <div id="answers"></div>
            </div>

            <button id="restartBtn" class="hidden"><i class="fas fa-redo"></i> Restart Game</button>
            <div id="message"></div>
        </div>
    </div>


    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const socket = io();

        // --- Elemen-elemen HTML ---
        const questionEl = document.getElementById('question');
        const answersEl = document.getElementById('answers');
        const messageEl = document.getElementById('message');
        const roomIdEl = document.getElementById('roomId');
        const roomNameEl = document.getElementById('roomName');
        const userListEl = document.getElementById('userList');
        const timeLeftEl = document.getElementById('timeLeft');
        const setupDiv = document.getElementById('setup');
        const gameAreaDiv = document.getElementById('gameArea');
        const createRoomBtn = document.getElementById('createRoomBtn');
        const joinRoomBtn = document.getElementById('joinRoomBtn');
        const usernameInput = document.getElementById('username');
        const joinRoomIdInput = document.getElementById('joinRoomId');
        const restartBtn = document.getElementById('restartBtn');
        const currentQuestionNumEl = document.getElementById('currentQuestionNum');
        const totalQuestionEl = document.getElementById('totalQuestion');

        // --- Cek username di localStorage ---
        const savedUsername = localStorage.getItem('quizUsername');
        if (savedUsername) {
            usernameInput.value = savedUsername;
        }

        // --- Event Listeners ---
        function handleRoomCreationOrJoin(success, message, roomId, questions) {
            if (success) {
                console.log(message, roomId);
                setupDiv.classList.add('hidden');
                gameAreaDiv.classList.remove('hidden');
                restartBtn.classList.remove('hidden');
                localStorage.setItem('quizUsername', usernameInput.value.trim()); // Simpan username

                if (questions && questions.length > 0) {
                    displayQuestion(questions[0]);
                }
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: message,
                });
            }
        }
        // --- Event Listeners ---
        createRoomBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            if (!username) {
              Swal.fire('Please enter a username.');
              return;
            }
             joinRoomIdInput.classList.add('hidden');
            socket.emit('createRoom', username, '', (response) => {
              handleRoomCreationOrJoin(response.success, 'Room created:', response.roomId, response.questions);
            });
        });

        joinRoomBtn.addEventListener('click', () => {
            const username = usernameInput.value.trim();
            const roomId = joinRoomIdInput.value.trim();
             if (!username) {
                Swal.fire('Please enter a username.');
                return;
            }
            if (!roomId) {
                Swal.fire('Please enter a room ID to join.');
                return;
            }
            joinRoomIdInput.classList.remove('hidden');
            socket.emit('joinRoom', roomId, username, (response) => {
               handleRoomCreationOrJoin(response.success, 'Joined room:', roomId, response.questions);
            });
        });

        restartBtn.addEventListener('click', () => {
            Swal.fire({
                title: 'Are you sure?',
                text: "This will restart the game for all players in the room!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, restart it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    socket.emit('restartGame');
                }
            });
        });
        // --- Socket.IO Events ---

        socket.on('roomInfo', (roomInfo) => {
            roomIdEl.textContent = roomInfo.roomId;
            roomNameEl.textContent = roomInfo.roomName;
            userListEl.innerHTML = '';
            roomInfo.users.forEach(user => {
                const li = document.createElement('li');
                li.textContent = `${user.username} (Score: ${user.score})`;
                userListEl.appendChild(li);
            });
             timeLeftEl.textContent = roomInfo.timeLeft;
            currentQuestionNumEl.textContent = roomInfo.currentQuestionIndex;
            totalQuestionEl.textContent = roomInfo.totalQuestions;
        });

        socket.on('nextQuestion', (question) => {
            displayQuestion(question);
        });

        socket.on('gameOver', (scores) => {
            let scoreboard = "Game Over!\n\nScores:\n";
            scores.sort((a, b) => b.score - a.score); // Urutkan skor
            scores.forEach(user => {
                scoreboard += `${user.username}: ${user.score}\n`;
            });

            Swal.fire({
                title: 'Game Over!',
                text: scoreboard,
                icon: 'info',
            });
            restartBtn.classList.remove('hidden');
        });
        socket.on('gameRestarted', (question) => {
            Swal.fire('Game Restarted!', 'The game has been restarted by the host.', 'info');
            displayQuestion(question);
        });

         socket.on('error', (message) => {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: message,
            });
        });

        // --- Fungsi-fungsi bantuan ---

        function displayQuestion(question) {
            questionEl.innerHTML = question.question;
            answersEl.innerHTML = '';
            question.answers.forEach((answer, index) => {
                const answerDiv = document.createElement('div');
                answerDiv.classList.add('answer');
                answerDiv.innerHTML = answer; // Gunakan innerHTML
                answerDiv.addEventListener('click', () => {
                    // Matikan event listener untuk semua jawaban
                    document.querySelectorAll('.answer').forEach(el => {
                        el.style.pointerEvents = 'none';
                    });
                    socket.emit('answerQuestion', index, (response) => {
                        if (response.correct) {
                            answerDiv.style.backgroundColor = 'lightgreen';
                        } else {
                            answerDiv.style.backgroundColor = 'lightcoral';
                          //Tidak ada jawaban yang benar, beri warna abu-abu saja
                        }
                    });
                });
                answersEl.appendChild(answerDiv);
            });
        }

        function showMessage(message) {
            messageEl.textContent = message;
        }
    </script>
</body>
</html>
